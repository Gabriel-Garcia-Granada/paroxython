<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.8.1" />
<title>paroxython.normalize_predicate API documentation</title>
<meta name="description" content="Process an input string to interpret it as a known predicate." />
<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css' rel='stylesheet'>
<link href='https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/8.0.0/sanitize.min.css' rel='stylesheet'>
<link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">
<style>.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cse.google.com/cse.js?cx=017837193012385208679:pey8ky8gdqw"></script>
<style>.gsc-control-cse {padding:0 !important;margin-top:1em}</style>
<script async src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_CHTML'></script>
<style>.homelink{display:block}.homelink:hover{color:inherit}.homelink img{margin:auto;margin-bottom:.3em}</style>
<link rel="canonical" href="https://pdoc3.github.io/pdoc/doc/paroxython/normalize_predicate.html">
<link rel="icon" href="https://pdoc.github.io/pdoc/logo.png">
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>paroxython.normalize_predicate</code></h1>
</header>
<section id="section-intro">
<p>Process an input string to interpret it as a known predicate.</p>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/laowantong/paroxython/blob/master/paroxython/normalize_predicate.py#L0-L67" class="git-link">Browse GitHub</a>
</summary>
<pre><code class="python">from typing import Tuple

import regex  # type: ignore

from .compare_spans import compare_spans
from .goodies import print_warning
from .user_types import Predicate


def normalize_predicate(predicate: str) -&gt; Tuple[Predicate, bool]:
    predicate = predicate.lower().strip()
    negated = True
    if predicate.startswith(&#34;!&#34;):
        predicate = predicate[1:]
    elif regex.search(r&#34;not\s+&#34;, predicate):
        predicate = predicate.replace(&#34;not &#34;, &#34;&#34;)
    elif regex.search(r&#34;\s+not&#34;, predicate):
        predicate = predicate.replace(&#34; not&#34;, &#34;&#34;)
    else:
        negated = False
    original = predicate = predicate.strip()
    predicate = regex.sub(r&#34; is\b|\bis &#34;, &#34;&#34;, predicate)
    if predicate not in compare_spans:
        # Convert usual comparison operators
        predicate = predicate.replace(&#34;&lt;=&#34;, &#34;≤&#34;).replace(&#34;==&#34;, &#34;=&#34;)
        # Ignore all other characters
        predicate = regex.sub(r&#34;[^xy&lt;=≤]&#34;, &#34;&#34;, predicate)
        # Treat the special case of identity
        predicate = regex.sub(r&#34;^(x=y|y=)$&#34;, &#34;x=y≤x=y&#34;, predicate)
        # If there is only one x (resp. y), expand it into x≤x (resp. y≤y)
        predicate = regex.sub(r&#34;^([^x]*)x([^x]*)$&#34;, r&#34;\1x≤x\2&#34;, predicate)
        predicate = regex.sub(r&#34;^([^y]*)y([^y]*)$&#34;, r&#34;\1y≤y\2&#34;, predicate)
        if original != predicate:  # pragma: no cover
            print_warning(f&#34;predicate &#39;{original}&#39; normalized into &#39;{predicate}&#39;.&#34;)
        if predicate not in compare_spans:
            raise ValueError(f&#34;Malformed predicate &#39;{predicate}&#39; in the pipeline.&#34;)
    return (compare_spans[predicate], negated)</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="paroxython.normalize_predicate.normalize_predicate"><code class="name flex">
<span>def <span class="ident">normalize_predicate</span></span>(<span>predicate: str) ‑> Tuple[Callable[[int, int], bool], bool]</span>
</code></dt>
<dd>
<div class="desc"><p>Ensure that the given predicate is correct or can be salvaged.</p>
<h2 id="description">Description</h2>
<p>The system first determines whether the predicate is negated or not, which can be expressed
either by an exclamation mark prefix or the word “not”. In this case, the negation marker
is extracted from the given string.</p>
<p>The resulting string is then normalized, <em>i.e.</em> replaced by a key of the dictionary
<code>compare_spans</code> defined in <code><a title="paroxython.compare_spans" href="compare_spans.html">paroxython.compare_spans</a></code>.
The verb <code>"is"</code> is ignored, except when it constitutes the whole string (thus, <code>"is after"</code> comes down to <code>"after"</code>). When an operator is not an Allen's name or a predefined synonym, the following normalization process is applied:</p>
<ol>
<li>Replace any <code>&lt;=</code> by <code>≤</code>.</li>
<li>Replace any <code>==</code> by <code>=</code>.</li>
<li>Strip all characters distinct from <code>"="</code>, <code>"&lt;"</code>, <code>"≤"</code>, <code>"x"</code> and <code>"y"</code>.</li>
<li>If the string is <code>"x=y"</code> or <code>"y=x"</code>, replace it by <code>"x=y≤x=y"</code>.</li>
<li>If the string contains only one <code>x</code> (resp. <code>y</code>), expand it into <code>x≤x</code> (resp. <code>y≤y</code>).</li>
</ol>
<p>This allows the user to be understood when entering formulas like
<code>x == y</code>, <code>x &lt;= y</code> or <code>y1 &lt; x1 == x2 &lt;= y2</code>.</p>
<h2 id="examples">Examples</h2>
<p>Browse
<a href="https://github.com/laowantong/paroxython/blob/master/tests/test_normalize_predicate.py"><code>test_normalize_predicate.py</code></a>
on GitHub.</p>
<h2 id="args">Args</h2>
<dl>
<dt><strong><code>predicate</code></strong> :&ensp;<code>str</code></dt>
<dd>Plain string to be interpreted as a predicate.</dd>
</dl>
<h2 id="raises">Raises</h2>
<dl>
<dt><code>ValueError</code></dt>
<dd>Raised when the input string is malformed beyond recognition.</dd>
</dl>
<h2 id="returns">Returns</h2>
<dl>
<dt><code>Tuple[Predicate, bool]</code></dt>
<dd>A tuple whose first member is a function (more precisely, a value
of the dictionary <code>compare_spans</code>), and second member is a boolean indicating whether
the result of this predicate must be negated.</dd>
</dl></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/laowantong/paroxython/blob/master/paroxython/normalize_predicate.py#L12-L68" class="git-link">Browse GitHub</a>
</summary>
<pre><code class="python">def normalize_predicate(predicate: str) -&gt; Tuple[Predicate, bool]:
    predicate = predicate.lower().strip()
    negated = True
    if predicate.startswith(&#34;!&#34;):
        predicate = predicate[1:]
    elif regex.search(r&#34;not\s+&#34;, predicate):
        predicate = predicate.replace(&#34;not &#34;, &#34;&#34;)
    elif regex.search(r&#34;\s+not&#34;, predicate):
        predicate = predicate.replace(&#34; not&#34;, &#34;&#34;)
    else:
        negated = False
    original = predicate = predicate.strip()
    predicate = regex.sub(r&#34; is\b|\bis &#34;, &#34;&#34;, predicate)
    if predicate not in compare_spans:
        # Convert usual comparison operators
        predicate = predicate.replace(&#34;&lt;=&#34;, &#34;≤&#34;).replace(&#34;==&#34;, &#34;=&#34;)
        # Ignore all other characters
        predicate = regex.sub(r&#34;[^xy&lt;=≤]&#34;, &#34;&#34;, predicate)
        # Treat the special case of identity
        predicate = regex.sub(r&#34;^(x=y|y=)$&#34;, &#34;x=y≤x=y&#34;, predicate)
        # If there is only one x (resp. y), expand it into x≤x (resp. y≤y)
        predicate = regex.sub(r&#34;^([^x]*)x([^x]*)$&#34;, r&#34;\1x≤x\2&#34;, predicate)
        predicate = regex.sub(r&#34;^([^y]*)y([^y]*)$&#34;, r&#34;\1y≤y\2&#34;, predicate)
        if original != predicate:  # pragma: no cover
            print_warning(f&#34;predicate &#39;{original}&#39; normalized into &#39;{predicate}&#39;.&#34;)
        if predicate not in compare_spans:
            raise ValueError(f&#34;Malformed predicate &#39;{predicate}&#39; in the pipeline.&#34;)
    return (compare_spans[predicate], negated)</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="Paroxython Home" href="index.html">
<img src="https://laowantong.github.io/paroxython/resources/logo.png" alt="Paroxython logo">
</a>
</header>
<div class="gcse-search" style="height: 70px"
data-as_oq="site:laowantong/paroxython.github.io inurl:github.com/laowantong/paroxython"
data-gaCategoryParameter="paroxython.normalize_predicate">
</div>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="paroxython" href="index.html">paroxython</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="paroxython.normalize_predicate.normalize_predicate" href="#paroxython.normalize_predicate.normalize_predicate">normalize_predicate</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.8.1</a>.</p>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad()</script>
</body>
</html>