<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.8.4" />
<title>paroxython.docs_user_manual API documentation</title>
<meta name="description" content="Pipeline tutorial: getting recommendations." />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML" integrity="sha256-kZafAc6mZvK3W3v1pHOcUix30OHQN6pU/NO2oFkqZVw=" crossorigin></script>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
<style>.homelink{display:block}.homelink:hover{color:inherit}.homelink img{margin:auto;margin-bottom:.3em}</style>
<link rel="canonical" href="https://pdoc3.github.io/pdoc/doc/paroxython/docs_user_manual/">
<link rel="icon" href="https://pdoc.github.io/pdoc/logo.png">
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">User manual</h1>
</header>
<section id="section-intro">
<h2 id="pipeline-tutorial-getting-recommendations">Pipeline tutorial: getting recommendations</h2>
<p>This tutorial walks you through a series of little “teacher stories” to illustrate how to write the pipeline of commands used by Paroxython's recommendation system.</p>
<p>You run this pipeline on command line with:</p>
<pre><code>paroxython recommend -p 'path/to/your/pipe.py' 'path/to/your/programs/db.json'
</code></pre>
<h3 id="covering-your-bases">Covering your base(s)</h3>
<p>Our simplest pipeline has no command: it just lists the programs of your database, without any
filter. This could produce a rather long document, since each source code is printed, along with a
list of each and every taxon it implements. Here is the content of your <code>pipe.py</code>:</p>
<pre><code class="python">&gt;&gt;&gt; []
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The point is that the resulting list is sorted by increasing learning cost. This should give
you a rough idea of the pedagogical angle of attack to adopt in your first classes.</p>
</div>
<h3 id="imparting-knowledge">Imparting knowledge</h3>
<h4 id="tracking-the-progress-of-your-course">Tracking the progress of your course</h4>
<p>Suppose that, in your first session, you have introduced your students to the <code>hello_world.py</code>,
<code>wheat_and_chessboard.py</code> and <code>euler_005_smallest_multiple.py</code> programs. Not only Paroxython should
no longer recommend these programs, but the cost of learning the associated concepts should be
considered as zero when they are encountered again in the future.</p>
<pre><code class="python">&gt;&gt;&gt; [
...     {
...         &quot;operation&quot;: &quot;impart&quot;,
...         &quot;data&quot;: [
...             &quot;hello_world.py&quot;,
...             &quot;wheat_and_chessboard.py&quot;,
...             &quot;euler_005_smallest_multiple.py&quot;,
...         ],
...     },
... ]
</code></pre>
<h4 id="coming-after-another-course">Coming after another course</h4>
<p>Suppose instead that you intervene after an introductory course given by a colleague. She gives you a
folder (named <code>"CS_101"</code>), which contains the programs she has studied with her class. Since you
are secretly in love, you assume, somewhat foolishly, that the concepts they implement are mastered
by your new students.</p>
<pre><code class="python">&gt;&gt;&gt; [
...     {
...         &quot;operation&quot;: &quot;impart&quot;,
...         &quot;data&quot;: &quot;find CS_101 -path '*.py'&quot;,
...     },
... ]
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>As you can see, rather than maintaining a <strong>list</strong> of programs or concepts in the <code>"data"</code>
field, you may provide a <strong>string</strong>. Paroxython will interpret it as a shell command, and
expect it to print on <code>stdout</code> the required list of items (programs or taxa), one per line.</p>
</div>
<h3 id="blacklisting-programs">Blacklisting programs</h3>
<p>You want to filter out all programs reserved for an exam, or too complex, or not pedagogically
interesting enough, or that could get you kicked out of your college, etc.</p>
<pre><code class="python">&gt;&gt;&gt; [
...     {
...         &quot;operation&quot;: &quot;exclude&quot;,
...         &quot;data&quot;: [
...             &quot;fizzbuzz.py&quot;,
...             &quot;alpha_go.py&quot;,
...             &quot;hello_world_of_pain.py&quot;,
...             &quot;gob_s_program.py&quot;,
...         ],
...     },
... ]
</code></pre>
<h3 id="concepts-to-be-introduced-later-or-never">Concepts to be introduced later (or never)</h3>
<p>For the time being, you don't want to be recommended any program requiring the concepts of
recursivity (<code>subroutine/recursive</code>), dictionary (<code>type/non_sequence/dictionary</code>) or set
(<code>type/non_sequence/set</code>).</p>
<pre><code class="python">&gt;&gt;&gt; [
...     {
...         &quot;operation&quot;: &quot;exclude&quot;,
...         &quot;data&quot;: [
...             &quot;subroutine/recursive&quot;,
...             &quot;type/non_sequence&quot;,
...         ],
...     },
... ]
</code></pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Paroxython relies on the last three characters of a <code>"data"</code> item to decide whether it is a
Python program (ending with <code>".py"</code>) or a taxon (like here).</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Since the two latter taxa share a common prefix and Python doesn't provide other non-sequence
type, it is enough to exclude all taxa starting with <code>type/non_sequence</code>.</p>
</div>
<h3 id="concepts-to-be-introduced-now">Concepts to be introduced now</h3>
<p>Your next class will be devoted to conditional constructs. Thus, you need to go through programs
featuring taxa prefixed by <code>flow/conditional</code> or even, why not, some conditional expressions
(<code>operator/ternary</code>). The suggested programs do not necessarily have to implement both concepts at
the same time, but at least one. Any other program will be rejected.</p>
<pre><code class="python">&gt;&gt;&gt; [
...     {
...         &quot;operation&quot;: &quot;include&quot;,
...         &quot;data&quot;: [
...             &quot;flow/conditional&quot;,
...             &quot;operator/ternary&quot;,
...         ],
...     },
... ]
</code></pre>
<h3 id="preparing-an-assignment">Preparing an assignment</h3>
<p>Basically, you provide Paroxython with a list of programs already studied in class, and it suggests
new programs that implement only old concepts. This requires the exclusion of all programs
featuring at least one concept that has not been seen in any of the programs already seen.</p>
<p>It may sound a little complicated, because it is. But don't panic. Remember that Paroxython always
orders its recommendations by increasing cost. Thus, all you have to do is ask it to list the
programs that have not been introduced yet. The programs you want to choose among will appear at
the top of the results, under the zero-learning cost section. Moreover, inside each section, they
will be sorted by increasing size (<a href="https://en.wikipedia.org/wiki/Source_lines_of_code"><abbr title="Source Lines Of Code">SLOC</abbr></a>),
which can be a reasonable proxy for their difficulty.</p>
<p>But in the end, you, the teacher, are the judge. Paroxython is not going to set up a test for you,
let alone grade the answers. It is just here to remind you of some possibilities you might not have
thought of at the right time, and to give you some confidence that the exercises require no concept
you have not pre-introduced in class, which later on might save you some awkward conversations with
your dear students.</p>
<p>Since this is the last filter in our tutorial, let's summarize what we've seen by chaining several
commands together:</p>
<ol>
<li><strong>Impart</strong> the previous knowledge by extracting all the programs listed in the <code>"timeline.txt"</code>
file that you update after each session. You can adapt the script
<a href="https://github.com/laowantong/paroxython/blob/master/paroxython/helpers/parse_syllabus.py"><code>parse_syllabus.py</code></a>
to your own needs. If you wish, you can use the <code>base_path</code> variable, which represents the
parent of the directory containing the programs of your personal database.</li>
<li><strong>Exclude</strong> some irrelevant programs.</li>
<li><strong>Include</strong> the concepts that you want to test during your exam.</li>
</ol>
<pre><code class="python">&gt;&gt;&gt; [
...     {
...         &quot;operation&quot;: &quot;impart&quot;,
...         &quot;data&quot;: &quot;python helpers/parse_syllabus.py {base_path}/timeline.txt&quot;,
...     },
...     {
...         &quot;operation&quot;: &quot;exclude&quot;,
...         &quot;data&quot;: [
...             &quot;foo.py&quot;,
...             &quot;bar.py&quot;,
...             # &quot;buzz.py&quot;,
...         ],
...     },
...     {
...         &quot;operation&quot;: &quot;include&quot;,
...         &quot;data&quot;: [
...             &quot;pattern/elements/accumulate&quot;,
...             &quot;topic/game&quot;,
...             &quot;type/sequence/list&quot;,
...         ],
...     },
... ]
</code></pre>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>This command pipeline is <em>not</em> a <abbr title="JavaScript Object Notation">JSON</abbr> file, but a Python program, or more restrictively a
Python <strong>expression</strong>. As such, it offers several amenities you surely know and love: comments,
trailing commas, r-strings, etc.</p>
</div>
<p>This is the end of our pipeline tutorial. If you dare, <a href="#deep-in-the-pipeline">read on</a> for more advanced features (regular expressions, span algebra, semantic triples, negations).</p>
<h2 id="tag-databases">Tag databases</h2>
<p>Depending on the extension of <code>DB_NAME</code> (either <code>".json"</code> or <code>".sqlite"</code>), the command:</p>
<pre><code>paroxython collect -o DB_NAME DIRECTORY
</code></pre>
<p>&hellip; will create two types of databases, each with their own purpose.</p>
<h3 id="the-json-tag-database">The <abbr title="JavaScript Object Notation">JSON</abbr> tag database</h3>
<p>It is this type of so-called NoSQL database that Paroxython draws upon to recommend programs. Its schema is as follows:</p>
<pre><code class="json">{
    &quot;programs&quot;: {
        &quot;program_1.py&quot; : {
            &quot;timestamp&quot;: &quot;1970-01-01&quot;,
            &quot;source&quot;: &quot;print('hello')\nprint('world')\n&quot;,
            &quot;labels&quot;: {
                &quot;label_1&quot;: [[span_start_1, span_end_1], ...],
                ...
            },
            &quot;taxa: {
                &quot;taxon_1&quot;: [[span_start_1, span_end_1], ...],
                ...
            }
        },
        ...
    }
    &quot;labels&quot;: {
        &quot;label_1&quot;: [&quot;program_1.py&quot;, &quot;program_2.py&quot;, ...],
        ...
    },
    &quot;taxa&quot;: {
        &quot;taxon_1&quot;: [&quot;program_1.py&quot;, &quot;program_2.py&quot;, ...],
        ...
    },
    &quot;importations&quot;: {
        &quot;program_1.py&quot;: [&quot;program_2.py&quot;, &quot;program_3.py&quot;, ...],
        ...
    },
    &quot;exportations&quot;: {
        &quot;program_1.py&quot;: [],
        &quot;program_2.py&quot;: [&quot;program_1.py&quot;, ...],
        ...
    }
}
</code></pre>
<p>As an example, take a look on the <a href="https://github.com/laowantong/paroxython/blob/master/examples/simple/programs_db.json"><abbr title="JavaScript Object Notation">JSON</abbr> tag database</a> of the Python Wiki's <a href="https://github.com/laowantong/paroxython/blob/master/examples/simple/programs">21 simple programs</a>.</p>
<h3 id="the-sqlite-database">The SQLite database</h3>
<p>This type of database is fundamentally agnostic, but lends itself quite well to statistics. The relational schema is as follows:</p>
<pre><code class="sql">CREATE TABLE program (
    program TEXT PRIMARY KEY,
    timestamp TEXT,
    source TEXT
);
CREATE TABLE label (
    -- use rowid as primary key
    name TEXT,
    name_prefix TEXT,
    name_suffix TEXT,
    span TEXT,
    span_start INTEGER,
    span_end INTEGER,
    program TEXT,
    FOREIGN KEY (program) REFERENCES program (program)
);
CREATE TABLE taxon (
    -- use rowid as primary key
    name TEXT,
    span TEXT,
    span_start INTEGER,
    span_end INTEGER,
    program TEXT,
    FOREIGN KEY (program) REFERENCES program (program)
);
</code></pre>
<p>Having a relational version of the tag database means that it can be queried with <abbr title="Structured Query Language">SQL</abbr>. Here is an example which returns the 20 most frequent taxa:</p>
<pre><code class="sql">SELECT name AS taxon, count(*) AS occurrences
FROM taxon
GROUP BY name
ORDER BY occurrences DESC
LIMIT 20
</code></pre>
<p>More complex, a query comparing the number of occurrences of the two kinds of loop:</p>
<pre><code class="sql">SELECT (CASE SUBSTR(name, 11, 3) -- extract either &quot;for&quot; or &quot;whi&quot;
            WHEN &quot;for&quot; THEN &quot;for&quot; -- and replace it either by... itself
            ELSE &quot;while&quot; -- or by the complete name of the loop
        END) AS loop,
       COUNT(*) AS occurrences
FROM taxon
WHERE name LIKE &quot;flow/loop/for%&quot;
   OR name LIKE &quot;flow/loop/while%&quot;
GROUP BY SUBSTR(name, 0, 14) -- cut the name three characters after &quot;flow/loop/&quot;
ORDER BY occurrences DESC
</code></pre>
<p>In theory, the relational database can also be used to select programs according to certain criteria:</p>
<pre><code class="sql">SELECT
    name AS taxon,
    program,
    group_concat(span, &quot;, &quot;) AS spans,
    source
FROM program
JOIN taxon USING (program)
WHERE name GLOB &quot;type/non_sequence/dictionary/*&quot;
GROUP BY name, program
</code></pre>
<p>On the provided <a href="https://github.com/laowantong/paroxython/blob/master/examples/simple/programs">simple programs</a>, the execution yields:</p>
<p><img alt="" src="../resources/sql_query_example.png"></p>
<p>Note however that the same list of programs (with learning costs!) could have been obtained by feeding the function <code><a title="paroxython.recommend_programs.Recommendations.run_pipeline" href="../recommend_programs.html#paroxython.recommend_programs.Recommendations.run_pipeline">Recommendations.run_pipeline()</a></code> with an elementary command:</p>
<pre><code class="python">    {
        &quot;operation&quot;: &quot;include&quot;,
        &quot;data&quot;: [&quot;type/non_sequence/dictionary/&quot;]
    }
</code></pre>
<p>So, although <abbr title="Structured Query Language">SQL</abbr> should be familiar to almost everyone in our target audience, and might “make complex things possible”, as far as filtering is concerned, our minimalistic schema arguably does not ”make simple things simple” (to paraphrase Alan Kay). Some denormalization should ease the process, but so far we have prioritized the development of the pipeline system.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Currently, the relational database is better suited for making statistics than recommendations.</p>
</div>
<h1 id="deep-in-the-pipeline">Deep in the pipeline</h1>
<p>This part describes in some details how the recommendation system works. It assumes you've already read the <a href="#pipeline-tutorial-getting-recommendations">tutorial on recommendations</a>. First of all, let us recall the example of pipeline we gave at the end.</p>
<pre><code class="python">&gt;&gt;&gt; [
...     {
...         &quot;operation&quot;: &quot;impart&quot;,
...         &quot;data&quot;: &quot;python helpers/parse_syllabus.py {base_path}/timeline.txt&quot;,
...     },
...     {
...         &quot;operation&quot;: &quot;exclude&quot;,
...         &quot;data&quot;: [
...             &quot;foo.py&quot;,
...             &quot;bar.py&quot;,
...             # &quot;buzz.py&quot;,
...         ],
...     },
...     {
...         &quot;operation&quot;: &quot;include&quot;,
...         &quot;data&quot;: [
...             &quot;pattern/elements/accumulate&quot;,
...             &quot;topic/game&quot;,
...             &quot;type/sequence/list&quot;,
...         ],
...     },
... ]
</code></pre>
<h2 id="regular-expression-patterns">Regular expression patterns</h2>
<p>The first thing to clarify is that the strings which constitute the <code>data</code> lists are not simple names, but “descriptions” of names. These descriptions, or <strong>patterns</strong>, are written in the language of regular expressions, and more precisely in the dialect implemented by the third-party module <a href="https://pypi.org/project/regex/">regex</a><sup id="fnref:regex-credits"><a class="footnote-ref" href="#fn:regex-credits" rel="footnote">1</a></sup>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you don't know how to write regular expressions, the good news is that you don't have to worry. Unless they contain certain special characters, they are self-descriptive. That means, for instance, that the string <code>"type/sequence/list"</code> happens to be a regular expression which precisely describes (or ”matches”) the string <code>"type/sequence/list"</code>. This is the case for all strings that are only made up of so-called <em>literal</em> characters.</p>
<p>As a matter of fact, all the characters that can appear in a taxon are literal. We advise you to avoid non-literal characters in your program names as well. What are they? Essentially: <code>.^$*+?{}\[]</code>. Depending on your operating system, some are already illegal in filenames anyway. To tell the truth, the first one (the dot) is an integral part of most filenames, as an extension separator. However, it turns out that it basically means “any character”, which of course includes the dot itself. So, the regular expression <code>"hello_world.py"</code> matches the filename <code>"hello_world.py"</code>, and the fact that it matches <code>"hello_world/py"</code> and <code>"hello_worldapy"</code> shouldn't be a real problem. In any case, you can always prefix (or <em>escape</em>) a non-literal character with a backslash <code>"\"</code> to make it literal (here, <code>"hello_world\.py"</code>): that's all you'll need to know about regular expressions.</p>
</div>
<p>The second thing to clarify is that a given pattern will match any string <strong>starting</strong> with it. Thus, <code>"type/sequence/list"</code> will match not only <code>"type/sequence/list"</code>, but <code>"type/sequence/list/empty"</code> and <code>"type/sequence/list/supercalifragilisticexpialidocious"</code> too. The same applies to program names. For example, in our personal database, all programs from <a href="https://projecteuler.net">Project Euler</a> start with <code>"euler_"</code>. The pattern <code>"euler_"</code> will then match all of them.</p>
<p>In terms of regular expressions, it means that, under the hood, Paroxython invokes <a href="https://docs.python.org/3/library/re.html#search-vs-match"><code>match()</code> instead of <code>search()</code></a>. In the rare cases where you want to restrict the whole matching to the pattern itself, simply suffix it with a dollar sign, i.e., <code>"type/sequence/list$"</code>.</p>
<h2 id="execution-of-a-pipeline">Execution of a pipeline</h2>
<p>A pipeline is a set (or list, but the order is not important) of commands which apply sequentially to a database of program tags. It returns:</p>
<ul>
<li>a list of recommended programs;</li>
<li>an estimation of the learning cost of each concept (i.e., taxon) they implement.</li>
</ul>
<p>The set of commands constitutes a pipeline that evolves both:</p>
<ul>
<li>a selection of programs (initially all those in the tag database);</li>
<li>a body of imparted knowledge (initially empty).</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>During this process, the program selection can never increase, and the imparted knowledge can never decrease.</p>
</div>
<p>A command consists of:</p>
<ul>
<li>an operation among <code>"include"</code>, <code>"exclude"</code>, <code>"impart"</code> and <code>"hide"</code>, optionally suffixed by the quantifier (<code>" all"</code>);</li>
<li>the data to which it applies. This data is (or can be interpreted to produce) a list of criteria, each criterion being:<ul>
<li>either a program pattern,</li>
<li>or a taxon pattern,</li>
<li>or a relationship between two taxon patterns (more on this in the <a href="#semantic-triples">Semantic triples</a> section).</li>
</ul>
</li>
</ul>
<p>Combining the operation with a criterion is done in four stages:</p>
<ol>
<li>An auxiliary set of programs is calculated.</li>
<li>The set of recommended programs (the <strong>selection</strong>) is updated.</li>
<li>A new set of taxa may be “learned”, i.e., added to the body of imparted knowledge.</li>
<li>The set of taxa and programs to hide in the final report may be updated.</li>
</ol>
<p>Note that each stage depends on both the operation and the nature of the criterion to which it applies. Let us detail every possible case:</p>
<h3 id="include-command"><code>"include"</code> command</h3>
<p>Its purpose is to keep only those selected programs that satisfy at least one given criterion.</p>
<ol>
<li>The auxiliary set contains any program such that:<ul>
<li>either its name matches the given pattern,</li>
<li>or its source code:<ul>
<li>either features at least one taxon matching the given pattern,</li>
<li>or satisfies the given relationship.</li>
</ul>
</li>
</ul>
</li>
<li>The selection is then restricted to its <strong>intersection</strong> with the auxiliary set.</li>
<li>The imparted knowledge is unchanged.</li>
</ol>
<p><strong><code>"include all"</code> variant</strong></p>
<p>Its purpose is to keep only those selected programs that satisfy all given criteria.</p>
<pre><code class="python">{
    &quot;operation&quot;: &quot;include all&quot;,
    &quot;data&quot;: [
        criterion_1,
        criterion_2,
        ...,
        criterion_n
    ]
}
</code></pre>
<p>&hellip; is equivalent to:</p>
<pre><code class="python">    {&quot;operation&quot;: &quot;include&quot;, &quot;data&quot;: [criterion_1]},
    {&quot;operation&quot;: &quot;include&quot;, &quot;data&quot;: [criterion_2]},
    ...,
    {&quot;operation&quot;: &quot;include&quot;, &quot;data&quot;: [criterion_n]}
</code></pre>
<h3 id="exclude-command"><code>"exclude"</code> command</h3>
<p>Its purpose is to filter out of the selection the programs which satisfy at least one given criterion.</p>
<ol>
<li>The same auxiliary set of programs as above (<code>"include"</code>) is calculated, but further extended to the programs which import them
(either directly or indirectly). Indeed, when the teacher wants to exclude a certain program, any program that requires it should be excluded as well.</li>
<li>The selection is then restricted to its <strong>difference</strong> with the auxiliary set.</li>
<li>The imparted knowledge is unchanged.</li>
</ol>
<p><strong><code>"exclude all"</code> variant</strong></p>
<p>Unlike <code>"include all"</code>, this variant actually expands the semantics of the system.</p>
<pre><code class="python">{
    &quot;operation&quot;: &quot;exclude all&quot;,
    &quot;data&quot;: [
        criterion_1,
        criterion_2,
        ...,
        criterion_n
    ]
}
</code></pre>
<p>&hellip; excludes the programs satisfying <strong>all</strong> the criteria. This cannot be transformed into a sequence of <code>"exclude"</code> commands, which would exclude the programs satisfying <strong>any</strong> of the criteria.</p>
<h3 id="impart-command"><code>"impart"</code> command</h3>
<p>Its main purpose is to track the acquisition of new knowledge. However, if this knowledge is provided by a given set of programs, there is no more need to keep them in the selection of recommended programs.</p>
<ol>
<li>The auxiliary set contains all programs whose name matches at least one of the given patterns (relationships are not supported), plus those which import (either directly or indirectly) at least one of them. In other words, it is the same as above (<code>"exclude"</code>), but only in the case where the criterion is a program pattern. In all other cases, this auxiliary set will be empty.</li>
<li>The selection is then restricted to its <strong>difference</strong> with the auxiliary set (same as above for <code>"exclude"</code>).</li>
<li>There are three cases:<ol>
<li>If the criterion is a program pattern, all the taxa featured in a program whose name matches this pattern are added to the body of imparted knowledge.</li>
<li>If the criterion is a taxon pattern, all the taxa matching this pattern are added to the body of imparted knowledge.</li>
<li>Otherwise, the body of imparted knowledge is unchanged.</li>
</ol>
</li>
</ol>
<p>The <code>"impart all"</code> variant is not supported, and treated as <code>"impart"</code>.</p>
<h3 id="hide-command"><code>"hide"</code> command</h3>
<p>This is the simplest command of all. It merely accumulates the programs or the taxa matching the given patterns (relationships are not supported), without other effect on the filter. In the final stage, the accumulated programs or taxa will be filtered out of report.</p>
<p><strong>Notes.</strong>
- Excluding a program is equivalent to hiding it <em>plus</em> every program importing it.
- The learning costs are not affected whatsoever by the hiding of a taxon: its individual cost continues to contribute towards the total cost of a program.</p>
<p>The <code>"hide all"</code> variant is not supported, and treated as <code>"hide"</code>.</p>
<h2 id="semantic-triples">Semantic triples</h2>
<h3 id="span-algebra">Span algebra</h3>
<p>Being given a program <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> of <span><span class="MathJax_Preview">n</span><script type="math/tex">n</script></span> lines, a couple <span><span class="MathJax_Preview">(i_1, i_2) </span><script type="math/tex">(i_1, i_2) </script></span> of line numbers such that <span><span class="MathJax_Preview">1 \leq i_1 \leq i_2 \leq n</span><script type="math/tex">1 \leq i_1 \leq i_2 \leq n</script></span> represents a <strong>span</strong> of <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>. When Paroxython finds a taxon <span><span class="MathJax_Preview">t</span><script type="math/tex">t</script></span> in <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span>, it doesn't just say whether <span><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> features <span><span class="MathJax_Preview">t</span><script type="math/tex">t</script></span> or not: it returns the list of spans where <span><span class="MathJax_Preview">t</span><script type="math/tex">t</script></span> occurs.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Any taxon starting with <code>"metadata/"</code> is considered by convention to span the entire program.</p>
</div>
<p>It is sometimes interesting to know how the spans of two taxa of the same program are located relatively to each other.</p>
<ul>
<li>For instance, a <code>print()</code> statement whose span is inside the span of a function indicates that this function has a side-effect.</li>
<li>A less trivial application stems from the fact that our taxonomy is multi-dimensional: each algorithmic feature can be associated with several taxa at the same time, characterizing it it along several dimensions. For instance, the taxa <code>flow/loop</code> and <code>flow/loop/while</code> describe the category of a loop; whereas the taxa <code>flow/loop/exit/early</code> and <code>flow/loop/exit/late</code> describe its exit behavior. These dimensions are independent and, although it is entirely possible to do so, our default taxonomy does not list the results of the cross-product (i.e., <code>flow/loop/exit/early</code>, <code>flow/loop/exit/late</code>, <code>flow/loop/while/exit/early</code> and <code>flow/loop/while/exit/late</code>). Querying an hypothetical taxon <code>flow/loop/exit/early</code> (or <code>flow/loop/exit/early/for</code>, by the way) comes down to querying the taxa <code>flow/loop</code> spanning the same lines as <code>flow/loop/exit/early</code>.</li>
</ul>
<p>To express a relation <span><span class="MathJax_Preview">\mathfrak{R}</span><script type="math/tex">\mathfrak{R}</script></span> between the spans of two taxa, we start from the algebra devised in 1983 by James F. Allen in his seminal paper (<a href="http://cse.unl.edu/~choueiry/Documents/Allen-CACM1983.pdf">PDF</a>) about temporal intervals<sup id="fnref:Allen1983"><a class="footnote-ref" href="#fn:Allen1983" rel="footnote">2</a></sup>. The so-called Allen's interval algebra defines 13 basic operators which capture all possible relations between two intervals <span><span class="MathJax_Preview">X=(x_1, x_2)</span><script type="math/tex">X=(x_1, x_2)</script></span> and <span><span class="MathJax_Preview">Y=(y_1, y_2)</span><script type="math/tex">Y=(y_1, y_2)</script></span>. The table below uses his terminology:</p>
<table>
<thead>
<tr>
<th align="center">Examples</th>
<th align="center"><span><span class="MathJax_Preview">\mathfrak{R}</span><script type="math/tex">\mathfrak{R}</script></span> on endpoints</th>
<th align="center"><span><span class="MathJax_Preview">X \mathbin{\mathfrak{R}} Y</span><script type="math/tex">X \mathbin{\mathfrak{R}} Y</script></span></th>
<th align="center"><span><span class="MathJax_Preview">Y \mathbin{\mathfrak{R}} X</span><script type="math/tex">Y \mathbin{\mathfrak{R}} X</script></span></th>
<th align="center">Keys</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><code>....XXXXX........</code> &nbsp;</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr>
<td align="center"><code>....YYYYY........</code> &nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">x_1 = y_1 \leq x_2 = y_2</span><script type="math/tex">x_1 = y_1 \leq x_2 = y_2</script></span>
&nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span> <code>equals</code> <span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span>
&nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span> <code>equals</code> <span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span>
&nbsp;</td>
<td align="center"><code>x=y≤x=y</code></td>
</tr>
<tr>
<td align="center"><code>....YYYYYYYYY....</code> &nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">x_1 = y_1 \leq x_2 \leq y_2</span><script type="math/tex">x_1 = y_1 \leq x_2 \leq y_2</script></span>
&nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span> <code>starts</code> <span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span>
&nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span> <code>started by</code> <span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span>
&nbsp;</td>
<td align="center"><code>x=y≤x≤y</code></td>
</tr>
<tr>
<td align="center"><code>..YYYYYYYYY......</code> &nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">y_1 \leq x_1 \leq x_2 \leq y_2</span><script type="math/tex">y_1 \leq x_1 \leq x_2 \leq y_2</script></span> &nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span> <code>during</code> <span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span>
&nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span> <code>contains</code> <span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span>
&nbsp;</td>
<td align="center"><code>y≤x≤x≤y</code></td>
</tr>
<tr>
<td align="center"><code>.YYYYYYYY........</code> &nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">y_1 \leq x_1 \leq x_2 = y_2</span><script type="math/tex">y_1 \leq x_1 \leq x_2 = y_2</script></span>
&nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span> <code>finishes</code> <span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span>
&nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span> <code>finished by</code> <span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span>
&nbsp;</td>
<td align="center"><code>y≤x≤x=y</code></td>
</tr>
<tr>
<td align="center"><code>....|...|..YYYYY.</code> &nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">x_1 \leq x_2 \leq y_1 \leq y_2</span><script type="math/tex">x_1 \leq x_2 \leq y_1 \leq y_2</script></span> &nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span> <code>before</code> <span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span>
&nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span> <code>after</code> <span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span>
&nbsp;</td>
<td align="center"><code>x≤x≤y≤y</code></td>
</tr>
<tr>
<td align="center"><code>....|...|YYYYY...</code> &nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">x_1 \leq x_2 = y_1 \leq y_2</span><script type="math/tex">x_1 \leq x_2 = y_1 \leq y_2</script></span>
&nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span> <code>meets</code> <span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span>
&nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span> <code>met by</code> <span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span>
&nbsp;</td>
<td align="center"><code>x≤x=y≤y</code></td>
</tr>
<tr>
<td align="center"><code>....|..YYYYY.....</code> &nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">x_1 \leq y_1 \leq x_2 \leq y_2</span><script type="math/tex">x_1 \leq y_1 \leq x_2 \leq y_2</script></span> &nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span> <code>overlaps</code> <span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span>
&nbsp;</td>
<td align="center"><span><span class="MathJax_Preview">Y</span><script type="math/tex">Y</script></span> <code>overlapped by</code> <span><span class="MathJax_Preview">X</span><script type="math/tex">X</script></span> &nbsp;</td>
<td align="center"><code>x≤y≤x≤y</code></td>
</tr>
</tbody>
</table>
<p>These well-known operators apply quite nicely to our spans, with the following adjustments:</p>
<p><strong>Synonyms.</strong> The 13 operator names, whose some don't make much sense in a non-temporal context, are extended
with a number of synonyms, such as <code>"inside"</code> for <code>"during"</code>, and <code>"equal"</code> or <code>"is"</code> for
<code>"equals"</code>. The current list can be found
<a href="https://github.com/laowantong/paroxython/blob/master/paroxython/compare_spans.py#L195">here</a>.</p>
<p><strong>Non-strict inequalities.</strong> In the above table, contrary to the convention on time intervals, we
consider the inequalities to be large. In a program, most features span exactly one (logical) line
(i.e., <span><span class="MathJax_Preview">x_1=x_2</span><script type="math/tex">x_1=x_2</script></span>): this is simply not possible with the original relations on endpoints. Besides,
when we look for a function which
<strong>contains</strong> a loop, we are generally not interested in whether
the loop <strong>finishes</strong> on the last line. Blind adherence to strictness convention would force us to
express our query as a disjunction of these two relations for the following program to be selected:</p>
<pre><code class="python">def first_missing_non_negative(l):
    elements = set(l)
    for natural in range(len(elements) + 1):
        if natural not in elements:
            return natural
</code></pre>
<p><strong>Strict inequalities.</strong> In addition to the existing relations, all combinations of strict and non-strict
conditions are generated, for instance <span><span class="MathJax_Preview">x_1 &lt; x_2 &lt; y_1 \leq y_2</span><script type="math/tex">x_1 < x_2 < y_1 \leq y_2</script></span>. That adds up to 162 in total<sup id="fnref:predicate_count"><a class="footnote-ref" href="#fn:predicate_count" rel="footnote">3</a></sup>.</p>
<p><strong>Keys.</strong> As we use many more operators than Allen, giving an English name to every single one is not an option. Paroxython actually identifies them by a unique key (see the last column of the table above) calculated like this:</p>
<ol>
<li>Start from the chain of equalities and inequalities that defines the relations between the two spans' endpoints: <span><span class="MathJax_Preview">y_1 &lt; x_1 = y_2 \leq x_2</span><script type="math/tex">y_1 < x_1 = y_2 \leq x_2</script></span>.</li>
<li>Drop the indices (since, for a given <span><span class="MathJax_Preview">x</span><script type="math/tex">x</script></span> or <span><span class="MathJax_Preview">y</span><script type="math/tex">y</script></span>, indice <span><span class="MathJax_Preview">1</span><script type="math/tex">1</script></span> always comes before indice <span><span class="MathJax_Preview">2</span><script type="math/tex">2</script></span>, no information is lost): <span><span class="MathJax_Preview">y &lt; x = y \leq x</span><script type="math/tex">y < x = y \leq x</script></span>.</li>
<li>Rewrite the formula using only the five characters <code>"="</code>, <code>"&lt;"</code>, <code>"≤"</code>, <code>"x"</code> and <code>"y"</code>: <code>y&lt;x=y≤x</code>.</li>
</ol>
<p><strong>Key normalization.</strong>
Paroxython tries (cf. <code><a title="paroxython.normalize_predicate.normalize_predicate" href="../normalize_predicate.html#paroxython.normalize_predicate.normalize_predicate">normalize_predicate()</a></code>) to be tolerant with the user input. The verb <code>"is"</code> is ignored, except when it constitutes the whole string (thus, <code>"is after"</code> comes down to <code>"after"</code>). When an operator is not an Allen's name or a predefined synonym, the following normalization process is applied:</p>
<ol>
<li>Replace any <code>&lt;=</code> by <code>≤</code>.</li>
<li>Replace any <code>==</code> by <code>=</code>.</li>
<li>Strip all characters distinct from <code>"="</code>, <code>"&lt;"</code>, <code>"≤"</code>, <code>"x"</code> and <code>"y"</code>.</li>
<li>If the string is <code>"x=y"</code> or <code>"y=x"</code>, replace it by <code>"x=y≤x=y"</code>.</li>
<li>If the string contains only one <code>x</code> (resp. <code>y</code>), expand it into <code>x≤x</code> (resp. <code>y≤y</code>).</li>
</ol>
<p>This allows the user to be understood when entering formulas like
<code>x == y</code>, <code>x &lt;= y</code> or <code>y1 &lt; x1 == x2 &lt;= y2</code>.</p>
<h3 id="positive-semantic-triples">Positive semantic triples</h3>
<p>A pipeline command can apply not only to patterns of programs and taxa, but also to relationships between the spans of two taxon patterns. Being given an operator <span><span class="MathJax_Preview">\mathfrak{R}</span><script type="math/tex">\mathfrak{R}</script></span> and two taxon patterns <span><span class="MathJax_Preview">t_1</span><script type="math/tex">t_1</script></span> and <span><span class="MathJax_Preview">t_2</span><script type="math/tex">t_2</script></span>, the statement <span><span class="MathJax_Preview">t_1 \mathbin{\mathfrak{R}} t_2</span><script type="math/tex">t_1 \mathbin{\mathfrak{R}} t_2</script></span> will be codified in the form of the <em>subject–predicate–object</em> expression <span><span class="MathJax_Preview">(t_1, \mathfrak{R}, t_2)</span><script type="math/tex">(t_1, \mathfrak{R}, t_2)</script></span>, which can be entered as a mere Python tuple <code>(t1, R, t2)</code>. The simplest semantic triple is:</p>
<pre><code class="python">(&quot;metadata/program&quot;, &quot;contains&quot;, taxon_pattern)
</code></pre>
<p>It matches all programs where the span of the taxon <code>"metadata/program"</code> includes the span of a given <code>taxon_pattern</code>. Since, by definition, every program features one taxon <code>"metadata/program"</code>, whose span encompasses the whole program, this is strictly equivalent to:</p>
<pre><code class="python">taxon_pattern
</code></pre>
<p>And now for something completely different: the following pipeline command will only keep programs featuring a conditional inside a loop <strong>or</strong> (inclusive) ended by a <code>return</code> statement (the function <code>first_missing_non_negative()</code> given above satisfies these two criteria).</p>
<pre><code class="python">    {
        &quot;operation&quot;: &quot;include&quot;,
        &quot;data&quot;: [
            (&quot;flow/loop&quot;, &quot;contains&quot;, &quot;flow/conditional&quot;),
            (&quot;flow/conditional&quot;, &quot;finished by&quot;, &quot;subroutine/return&quot;),
        ]
    },
</code></pre>
<p>It is currently not possible to chain several operators with shared operands, for example to keep only the programs that feature a conditional inside a loop <strong>and</strong> ended by a <code>return</code> statement: the quintuple <code>("flow/loop", "contains", "flow/conditional", "finished by", "subroutine/return")</code> would raise an error. As it stands, the best that we can do is to chain the commands themselves:</p>
<pre><code class="python">    {
        &quot;operation&quot;: &quot;include&quot;,
        &quot;data&quot;: [
            (&quot;flow/loop&quot;, &quot;contains&quot;, &quot;flow/conditional&quot;),
        ]
    },
    {
        &quot;operation&quot;: &quot;include&quot;,
        &quot;data&quot;: [
            (&quot;flow/conditional&quot;, &quot;finished by&quot;, &quot;subroutine/return&quot;),
        ]
    },
    {
        &quot;operation&quot;: &quot;include&quot;,
        &quot;data&quot;: [
            (&quot;subroutine/return&quot;, &quot;contains&quot;, &quot;flow/loop&quot;),
        ]
    },
</code></pre>
<p>This keeps only the programs that feature a conditional inside a loop <strong>and</strong> a conditional ended by a <code>return</code> statement <strong>and</strong> a <code>return</code> statement inside a loop. The result is a subset of the previous one, but may still include programs where the two loops, conditionals or <code>return</code> statements are distinct.</p>
<h3 id="negative-semantic-triples">Negative semantic triples</h3>
<p>It is possible to negate the predicate of a semantic triple, either by prefixing it by an exclamation mark (e.g., <code>"!x≤y≤y≤x"</code>, or <code>"!contains"</code>), or by adding the word <em>not</em> (<em>e.g</em>, <code>"not x≤y≤y≤x"</code>, <code>"not contains"</code>,
or <code>"contains not"</code>), whether it's grammatically correct or not.</p>
<h4 id="expressing-the-absence-of-a-taxon">Expressing the absence of a taxon</h4>
<p>Here again, the simplest <em>negated</em> semantic triple is:</p>
<pre><code class="python">(&quot;metadata/program&quot;, &quot;not contains&quot;, taxon_pattern)
</code></pre>
<p>On a set of <strong>independent programs</strong> (i.e., not importing each other), there is a strict equivalence between:</p>
<pre><code class="python">    {
        &quot;operation&quot;: &quot;include&quot;,
        &quot;data&quot;: [
            (&quot;metadata/program&quot;, &quot;not contains&quot;, taxon_pattern)
        ]
    },
</code></pre>
<p>and:</p>
<pre><code class="python">    {
        &quot;operation&quot;: &quot;exclude&quot;,
        &quot;data&quot;: [
            taxon_pattern
        ]
    },
</code></pre>
<p>And, conversely, between:</p>
<pre><code class="python">    {
        &quot;operation&quot;: &quot;include&quot;,
        &quot;data&quot;: [
            taxon_pattern
        ]
    },
</code></pre>
<p>and:</p>
<pre><code class="python">    {
        &quot;operation&quot;: &quot;exclude&quot;,
        &quot;data&quot;: [
            (&quot;metadata/program&quot;, &quot;not contains&quot;, taxon_pattern)
        ]
    },
</code></pre>
<p>This property may be used to select the programs that include any subset of a given set of taxa. This can be done in a systematic way by converting<sup id="fnref:to_cnf"><a class="footnote-ref" href="#fn:to_cnf" rel="footnote">4</a></sup> the corresponding logical formula in <a href="https://en.wikipedia.org/wiki/Conjunctive_normal_form">conjunctive normal form</a>, and transforming each clause into a separate <code>"include"</code> command.</p>
<p>For instance, consider the two taxa <code>"flow/conditional"</code> and <code>"flow/loop"</code>. To keep only the programs that feature either a conditional (denoted by the literal <span><span class="MathJax_Preview">a</span><script type="math/tex">a</script></span>) or a loop (denoted by the literal <span><span class="MathJax_Preview">b</span><script type="math/tex">b</script></span>), but not both of them, express first the formula in <abbr title="Conjunctive Normal Form">CNF</abbr>: <span><span class="MathJax_Preview">(a \lor b) \land (\neg a \lor \neg b)</span><script type="math/tex">(a \lor b) \land (\neg a \lor \neg b)</script></span>, then translate it into:</p>
<pre><code class="python">    {
        &quot;operation&quot;: &quot;include&quot;,
        &quot;data&quot;: [
            &quot;flow/conditional&quot;,
            &quot;flow/loop&quot;,
        ]
    }, # keep only the programs that feature either a conditional or a loop
    {
        &quot;operation&quot;: &quot;include&quot;,
        &quot;data&quot;: [
            (&quot;metadata/program&quot;, &quot;not contains&quot;, &quot;flow/conditional&quot;),
            (&quot;metadata/program&quot;, &quot;not contains&quot;, &quot;flow/loop&quot;),
        ]
    }, # among them, keep only those that feature no conditional or no loop
</code></pre>
<p>For two taxa, there are a total of 16 combinations, listed and tested <a href="https://github.com/laowantong/paroxython/blob/master/tests/test_recommend_programs.py#L664-L693">here</a>.
<!---
The previous link is automatically updated by build_pdoc.py.
--></p>
<p>However, on a set on <strong>interdependent programs</strong>, <code>"exclude"</code> is not the opposite of <code>"include"</code> anymore: <a href="#exclude-command">as already explained</a>, excluding a program excludes also the programs which import it. Consequently, <em>including</em> the programs that do not feature a given taxon will filter out those which feature it <em>directly</em>; but <em>excluding</em> the programs that do feature this taxon will filter out those which feature it either directly or <em>indirectly</em> (by importation).</p>
<h4 id="general-semantics-of-the-negation">General semantics of the negation</h4>
<p>The semantic triple:</p>
<pre><code class="python">(taxon_pattern_1, not predicate, taxon_pattern_2)
</code></pre>
<p>&hellip; describe the set of programs which feature at least one taxon matching <code>taxon_pattern_1</code>, and such that, for any
span <code>s_1</code> of such a taxon, there exists no span <code>s_2</code> of a taxon matching <code>taxon_pattern_2</code> for which <code>predicate(s_1, s_2)</code> is verified.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Note that the result includes also all programs featuring at least one taxon matching <code>taxon_pattern_1</code>, but no taxon matching <code>taxon_pattern_2</code>. For instance, suppose the original (negative) triple is:</p>
<p><code>("subroutine", "not contains", "variable/assignment")</code></p>
<p>The function will return the (disjoint) union of these two sets:</p>
<ol>
<li>The programs featuring at least one subroutine, but no assignment at all.</li>
<li>The programs featuring at least one subroutine, at least one assignment, but no assignment inside a subroutine.</li>
</ol>
</div>
<p>For example, if the original (negative) predicate is <code>"taxon_pattern_1 not inside taxon_pattern_2"</code>, any program consisting in:</p>
<ul>
<li><code>"taxon_2{taxon_1}"</code><sup id="fnref:braces"><a class="footnote-ref" href="#fn:braces" rel="footnote">5</a></sup> is rejected;</li>
<li><code>"taxon_1"</code> is <strong>accepted</strong> (although there is no <code>taxon_2</code>);</li>
<li><code>"taxon_2"</code> is <strong>rejected</strong> (no <code>taxon_1</code>);</li>
<li><code>"taxon_1{taxon_2}"</code> is accepted;</li>
<li><code>"taxon_1 taxon_2{taxon_1}"</code> is accepted (there exists a couple (<code>s_1</code>, <code>s_2</code>) such
that <code>taxon_1</code> is not inside <code>taxon_2</code>);</li>
<li><code>"taxon_1 taxon_2{taxon_1} taxon_2{}"</code> is accepted.</li>
</ul>
<p>If the predicate is <code>"taxon_pattern_2 not contains taxon_pattern_1"</code> (sic), any program consisting in:</p>
<ul>
<li><code>"taxon_2{taxon_1}"</code> is rejected;</li>
<li><code>"taxon_1"</code> is <strong>rejected</strong> (no <code>taxon_2</code>);</li>
<li><code>"taxon_2"</code> is <strong>accepted</strong> (although there is no <code>taxon_1</code>);</li>
<li><code>"taxon_1{taxon_2}"</code> is accepted;</li>
<li><code>"taxon_1 taxon_2{taxon_1}"</code> is accepted (there exists a couple (<code>s_1</code>, <code>s_2</code>) such
that <code>taxon_2</code> does not contain <code>taxon_1</code>);</li>
<li><code>"taxon_1 taxon_2{taxon_1} taxon_2{}"</code> is accepted.</li>
</ul>
<p>Note that, due to the rule explained in the warning above, <code>"taxon_pattern_1 not inside taxon_pattern_2"</code> is not equivalent to <code>"taxon_pattern_2 not contains taxon_pattern_1"</code> (differences in <strong>bold</strong>). However, if <code>taxon_pattern_2</code> is <code>"metadata/program"</code>, which is featured by all programs, these two forms become equivalent again.</p>
<h4 id="a-practical-example">A practical example</h4>
<p>Suppose you want your course on the assignment statements to include the concept of parallel assignment, for example to introduce swapping without an auxiliary variable:</p>
<pre><code class="python">(a, b) = (b, a)
</code></pre>
<p>In the taxonomy, this concept is listed as a special case of both tuple (<code>"type/sequence/tuple"</code>) and variable assignment (<code>"variable/assignment/parallel"</code>).</p>
<p>However, you want to introduce officially the abstract data type “tuple” only much later in your course. You therefore wish to exclude from the recommendations any program implementing a tuple, unless it is part of a parallel assignment. The following command will make the trick:</p>
<pre><code class="python">    {
        &quot;operation&quot;: &quot;exclude&quot;,
        &quot;data&quot;: [
            (&quot;type/sequence/tuple&quot;, &quot;is not&quot;, &quot;variable/assignment/parallel&quot;)
        ]
    },
</code></pre>
<p>The triple describes the set of programs which feature at least one tuple, and such that there is no tuple's span coinciding with a parallel assignment's span. In other words, the set of programs which feature at least one “non parallel” tuple. When we exclude these programs, those which remain either feature no tuple, or only the ones involved in a parallel assignment.</p>
<p>The other combinations are listed and tested <a href="https://github.com/laowantong/paroxython/blob/master/tests/test_recommend_programs.py#L780-L809">here</a>.
<!---
The previous link is automatically updated by build_pdoc.py.
--></p>
<div class="footnote">
<hr>
<ol>
<li id="fn:regex-credits">
<p>This module appears to be here to stay, since it is proeminently featured in the documentation of the more mundane standard library <a href="https://docs.python.org/3/library/re.html">re</a>.
Thanks and kudos to the author, Matthew Barnett: without his awesome work, many parts of our code would have been much tougher to write, and much slower to execute.&#160;<a class="footnote-backref" href="#fnref:regex-credits" rev="footnote" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
<li id="fn:Allen1983">
<p>Allen, James F. (26 Nov. 1983). <em>Maintaining knowledge about temporal intervals</em>. Communications of the ACM. 26 (11): 832–843. doi:10.1145/182.358434&#160;<a class="footnote-backref" href="#fnref:Allen1983" rev="footnote" title="Jump back to footnote 2 in the text">&#8617;</a></p>
</li>
<li id="fn:predicate_count">
<p><span><span class="MathJax_Preview">162 = 6 \times 27</span><script type="math/tex">162 = 6 \times 27</script></span>, where <span><span class="MathJax_Preview">6</span><script type="math/tex">6</script></span> is the number of distinct permutations of the quadruple <span><span class="MathJax_Preview">(x, x, y, y)</span><script type="math/tex">(x, x, y, y)</script></span>, and <span><span class="MathJax_Preview">27=3^3</span><script type="math/tex">27=3^3</script></span> the number of elements of the triple auto-product of <span><span class="MathJax_Preview">3</span><script type="math/tex">3</script></span> symbols (<code>=</code>, <code>≤</code> and <code>&lt;</code>).&#160;<a class="footnote-backref" href="#fnref:predicate_count" rev="footnote" title="Jump back to footnote 3 in the text">&#8617;</a></p>
</li>
<li id="fn:to_cnf">
<p>Automate the conversion with the function <a href="https://github.com/sympy/sympy/blob/58e1e9abade7c38c66871fd06bf76ebac8c1df78/sympy/logic/boolalg.py#L1691-L1730"><code>to_cnf()</code></a> of <a href="https://www.sympy.org/en/index.html">SymPy</a>.&#160;<a class="footnote-backref" href="#fnref:to_cnf" rev="footnote" title="Jump back to footnote 4 in the text">&#8617;</a></p>
</li>
<li id="fn:braces">
<p>In these examples, the braces denote the fact that the span of a certain taxon is included in that of another taxon.&#160;<a class="footnote-backref" href="#fnref:braces" rev="footnote" title="Jump back to footnote 5 in the text">&#8617;</a></p>
</li>
</ol>
</div>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="Paroxython Home" href="../index.html">
<img src="https://laowantong.github.io/paroxython/resources/logo.png" alt="Paroxython logo">
</a>
</header>
<h1>User manual</h1>
<div class="toc">
<ul>
<li><a href="#pipeline-tutorial-getting-recommendations">Pipeline tutorial: getting recommendations</a><ul>
<li><a href="#covering-your-bases">Covering your base(s)</a></li>
<li><a href="#imparting-knowledge">Imparting knowledge</a><ul>
<li><a href="#tracking-the-progress-of-your-course">Tracking the progress of your course</a></li>
<li><a href="#coming-after-another-course">Coming after another course</a></li>
</ul>
</li>
<li><a href="#blacklisting-programs">Blacklisting programs</a></li>
<li><a href="#concepts-to-be-introduced-later-or-never">Concepts to be introduced later (or never)</a></li>
<li><a href="#concepts-to-be-introduced-now">Concepts to be introduced now</a></li>
<li><a href="#preparing-an-assignment">Preparing an assignment</a></li>
</ul>
</li>
<li><a href="#tag-databases">Tag databases</a><ul>
<li><a href="#the-json-tag-database">The JSON tag database</a></li>
<li><a href="#the-sqlite-database">The SQLite database</a></li>
</ul>
</li>
<li><a href="#deep-in-the-pipeline">Deep in the pipeline</a><ul>
<li><a href="#regular-expression-patterns">Regular expression patterns</a></li>
<li><a href="#execution-of-a-pipeline">Execution of a pipeline</a><ul>
<li><a href="#include-command">"include" command</a></li>
<li><a href="#exclude-command">"exclude" command</a></li>
<li><a href="#impart-command">"impart" command</a></li>
<li><a href="#hide-command">"hide" command</a></li>
</ul>
</li>
<li><a href="#semantic-triples">Semantic triples</a><ul>
<li><a href="#span-algebra">Span algebra</a></li>
<li><a href="#positive-semantic-triples">Positive semantic triples</a></li>
<li><a href="#negative-semantic-triples">Negative semantic triples</a><ul>
<li><a href="#expressing-the-absence-of-a-taxon">Expressing the absence of a taxon</a></li>
<li><a href="#general-semantics-of-the-negation">General semantics of the negation</a></li>
<li><a href="#a-practical-example">A practical example</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.8.4</a>.</p>
</footer>
</body>
</html>